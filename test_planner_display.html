<!DOCTYPE html>
<html>
<head>
    <title>Test Planner Display</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Planner Display Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Check Current Tasks</h3>
        <button onclick="checkTasks()">Check Tasks in Database</button>
        <div id="result1"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Add Sample Task</h3>
        <button onclick="addSampleTask()">Add Sample Task</button>
        <div id="result2"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Open Morning Planner</h3>
        <a href="/ergon/daily-workflow/morning-planner" target="_blank" style="display: inline-block; padding: 10px 15px; background: #007cba; color: white; text-decoration: none; border-radius: 4px;">Open Morning Planner</a>
    </div>
    
    <script>
        function checkTasks() {
            fetch('/ergon/daily-workflow/get-tasks?date=' + new Date().toISOString().split('T')[0])
            .then(response => response.json())
            .then(data => {
                const result = document.getElementById('result1');
                if (data.success) {
                    result.innerHTML = '<span class="success">✓ Found ' + data.tasks.length + ' tasks for today</span>';
                    if (data.tasks.length > 0) {
                        result.innerHTML += '<br><small>Latest task: ' + data.tasks[0].title + '</small>';
                    }
                } else {
                    result.innerHTML = '<span class="error">✗ Error: ' + (data.error || 'Unknown error') + '</span>';
                }
            })
            .catch(error => {
                document.getElementById('result1').innerHTML = '<span class="error">✗ Network error: ' + error.message + '</span>';
            });
        }
        
        function addSampleTask() {
            const formData = new FormData();
            formData.append('plans[0][title]', 'Sample Display Test Task ' + Date.now());
            formData.append('plans[0][description]', 'This is a test task to verify display functionality');
            formData.append('plans[0][priority]', 'medium');
            formData.append('plans[0][estimated_hours]', '1.5');
            
            fetch('/ergon/daily-workflow/submit-morning-plans', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const result = document.getElementById('result2');
                if (data.success) {
                    result.innerHTML = '<span class="success">✓ Sample task added! Check the morning planner page.</span>';
                } else {
                    result.innerHTML = '<span class="error">✗ Error: ' + (data.error || 'Unknown error') + '</span>';
                }
            })
            .catch(error => {
                document.getElementById('result2').innerHTML = '<span class="error">✗ Network error: ' + error.message + '</span>';
            });
        }
        
        // Auto-check tasks on load
        setTimeout(checkTasks, 500);
    </script>
</body>
</html>