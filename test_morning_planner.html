<!DOCTYPE html>
<html>
<head>
    <title>Test Morning Planner Functionality</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; }
        input, textarea, select { width: 300px; padding: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Morning Planner Functionality Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Submit Morning Plan (AJAX)</h3>
        <form id="testPlanForm">
            <input type="text" name="plans[0][title]" placeholder="Task Title" value="Test Morning Task" required><br>
            <textarea name="plans[0][description]" placeholder="Description">Test task description for morning planner</textarea><br>
            <select name="plans[0][priority]">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
            </select><br>
            <input type="number" name="plans[0][estimated_hours]" value="2" min="0.5" max="8" step="0.5"><br>
            <button type="submit">Submit Plan</button>
        </form>
        <div id="result1"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Get Today's Tasks</h3>
        <button onclick="testGetTasks()">Get Tasks</button>
        <div id="result2"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Direct Navigation</h3>
        <a href="/ergon/daily-workflow/morning-planner" target="_blank">Open Morning Planner</a>
    </div>
    
    <script>
        document.getElementById('testPlanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/ergon/daily-workflow/submit-morning-plans', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const result = document.getElementById('result1');
                if (data.success) {
                    result.innerHTML = '<span class="success">✓ Plan submitted successfully!</span>';
                    // Reset form
                    document.getElementById('testPlanForm').reset();
                    document.querySelector('input[name="plans[0][title]"]').value = 'Test Morning Task ' + Date.now();
                } else {
                    result.innerHTML = '<span class="error">✗ Error: ' + (data.error || 'Unknown error') + '</span>';
                }
            })
            .catch(error => {
                document.getElementById('result1').innerHTML = '<span class="error">✗ Network error: ' + error.message + '</span>';
            });
        });
        
        function testGetTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            fetch('/ergon/daily-workflow/get-tasks?date=' + today)
            .then(response => response.json())
            .then(data => {
                const result = document.getElementById('result2');
                if (data.success) {
                    let html = '<h4>Tasks for today (' + data.tasks.length + '):</h4>';
                    if (data.tasks && data.tasks.length > 0) {
                        html += '<ul>';
                        data.tasks.forEach(task => {
                            html += '<li><strong>' + task.title + '</strong> (' + task.priority + ', ' + task.estimated_hours + 'h) - ' + task.status + '</li>';
                        });
                        html += '</ul>';
                    } else {
                        html += '<p>No tasks found for today.</p>';
                    }
                    result.innerHTML = html;
                } else {
                    result.innerHTML = '<span class="error">Error: ' + (data.error || 'Unknown error') + '</span>';
                }
            })
            .catch(error => {
                document.getElementById('result2').innerHTML = '<span class="error">Network error: ' + error.message + '</span>';
            });
        }
        
        // Auto-test on page load
        setTimeout(() => {
            testGetTasks();
        }, 1000);
    </script>
</body>
</html>